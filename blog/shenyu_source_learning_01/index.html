<!doctype html><html><head><title>ShenYuLearning(1) Environment Configuration · Apache ShenYu</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="The girl on the prairie"><meta name=generator content="Hugo 0.55.5"><link rel="shortcut icon" href=/img/favicon.png type=image/png><link href=https://unpkg.com/purecss@1.0.0/build/base-min.css rel=stylesheet><link href=/css/main.css rel=stylesheet><link href=/css/zoom-image.css rel=stylesheet><script src=/js/iconfont.js></script><script src=/js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script>window.SITE_LANGUAGE="en"</script><script src=/js/app.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-187960192-2','auto');ga('send','pageview');}</script></head><body><header class=ss-header><nav class=navbar role=navigation aria-label="main navigation"><div class=navbar-brand><a class=logo-link style=font-size:25px;margin-right:50px href=/><img class=logo src=/img/logo/apache-shenyu.png></a><div class=-show-mobile><a id=mobile-menu-icon><svg class="icon" aria-hidden="true"><use xlink:href="#icon-menu"/></svg></a><nav id=mobile-menu><div id=js-menu-search-mobile class=navbar-search-mobile><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div><a href=/projects/shenyu/download/><span>Download</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/projects/shenyu/overview/><span>Documentation</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/community/subscribe-email/><span>Community</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/news/><span>News</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/awesome/><span>Awesome</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"/></svg></a>
<a href=/zh/blog/shenyu_source_learning_01/><span>中文</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"/></svg></a></nav></div></div><div class="navbar-menu -hidden-mobile"><div class=navbar-start><a class=navbar-item href=/projects/shenyu/download/>Download</a>
<a class=navbar-item href=/projects/shenyu/overview/>Documentation</a>
<a class=navbar-item href=/community/subscribe-email/>Community</a>
<a class=navbar-item href=/news/>News</a>
<a class=navbar-item href=/awesome/>Awesome</a>
<span class="navbar-item nav-hover"><a>Links</a><div class=dropdown-menu><a class=dropdown-item href=https://www.apache.org/>Apache Software Foundation</a>
<a class=dropdown-item href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=dropdown-item href=https://www.apache.org/>License</a>
<a class=dropdown-item href=http://www.apache.org/events/current-event>Apache Events</a>
<a class=dropdown-item href=https://www.apache.org/licenses/>Security</a>
<a class=dropdown-item href=http://www.apache.org/foundation/sponsorship.html>Sponsor and Donate</a>
<a class=dropdown-item href=http://www.apache.org/foundation/thanks.html>Thanks</a></div></span></div><div class=navbar-end><div class=navbar-item><div id=js-menu-search class=navbar-search><input class=input placeholder=Search><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search"/></svg></div></div><div class=navbar-item><a class=translation href=/zh/blog/shenyu_source_learning_01/>中</a></div></div></div></nav></header><div class=ss-layout-container><main class="ss-layout-main -card"><div class=ss-meta><h1 class=title>ShenYuLearning(1) Environment Configuration</h1><div class=meta>2021-01-15 ·
chenxi ·
<span class=tags><a class=tag href=/tags/apache-shenyu/ rel=tag>#Apache ShenYu</a></span></div></div><article class=typo><h1 id=analysis-of-apache-shenyu-1-set-up-shenyu-environment>Analysis of Apache ShenYu (1) Set up ShenYu environment</h1><blockquote><p>ShenYu is a High-Performance Java API Gateway</p><p>GitHub：<a href=https://github.com/apache/incubator-shenyu>https://github.com/apache/incubator-shenyu</a></p><p>document：<a href=https://dromara.org/zh-cn/docs/soul/soul.html>https://dromara.org/zh-cn/docs/soul/soul.html</a></p></blockquote><h2 id=1-prepare-source-code>1. Prepare source code</h2><h3 id=1-1-fork-dromara-soul-https-github-com-apache-incubator-shenyu-git-repository-to-my-github-cchenxi-soul-https-github-com-cchenxi-soul-git>1.1. Fork <a href=https://github.com/apache/incubator-shenyu.git>dromara/soul</a> repository to my github <a href=https://github.com/cchenxi/soul.git>cchenxi/soul</a></h3><h3 id=1-2-clone-the-repository>1.2. Clone the repository</h3><pre><code class=language-shell>git clone https://github.com/cchenxi/soul.git
</code></pre><h3 id=1-3-open-the-source-code-with-idea>1.3.Open the source code with idea</h3><h3 id=1-4-compile-the-apache-shenyu-source-code>1.4. Compile the Apache ShenYu source code</h3><p>You can compile the project as follows.</p><pre><code class=language-shell>mvn clean package install -Dmaven.test.skip=true -Dmaven.javadoc.skip=true -Drat.skip=true -Dcheckstyle.skip=true
</code></pre><p><img src=/img/shenyu/01/16106054898861.jpg alt=-w1723></p><h2 id=2-startup-soul>2. Startup <code>soul</code></h2><h3 id=2-1-startup-soul-admin-module>2.1. Startup <code>soul-admin</code> module</h3><blockquote><p><code>soul-admin</code> is the management system for soul.</p></blockquote><p>Choose to use <code>MySQL</code> to storage gateway data and modify the datasource config.</p><p><img src=/img/shenyu/01/16106065488032.jpg alt=-w1186></p><p>Run <code>org.dromara.soul.admin.SoulAdminBootstrap</code>.</p><p>When success, please visit the website <code>http://localhost:9095/</code>, then jump to the login page, and input the corresponding user name and password to log in.</p><p>The user name is <code>admin</code> and the password is <code>123456</code>.</p><p><img src=/img/shenyu/01/16106069731233.jpg alt=-w593></p><p><img src=/img/shenyu/01/16106073045599.jpg alt=-w1262></p><h3 id=2-2-startup-soul-bootstrap-module>2.2. Startup <code>soul-bootstrap</code> module</h3><blockquote><p><code>soul-bootstrap</code> is the core of soul.</p></blockquote><p>Check the configuration of <code>soul-bootstrap</code>.</p><p><img src=/img/shenyu/01/16106076385761.jpg alt=-w917></p><p>Please make sure the ip and the port has been configured for <code>soul-admin</code>.</p><p>If the console output as follows, it means the startup is successful.</p><pre><code class=language-plain>2021-01-14 15:01:15.832  INFO 17943 --- [           main] b.s.s.d.w.WebsocketSyncDataConfiguration : you use websocket sync ShenYu data.......
2021-01-14 15:01:15.924  INFO 17943 --- [           main] o.d.s.p.s.d.w.WebsocketSyncDataService   : websocket connection is successful.....
2021-01-14 15:01:16.113  INFO 17943 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 2 endpoint(s) beneath base path '/actuator'
log4j:WARN No appenders could be found for logger (com.alibaba.dubbo.common.logger.LoggerFactory).
log4j:WARN Please initialize the log4j system properly.
log4j:WARN See http://logging.apache.org/log4j/1.2/faq.html#noconfig for more info.
2021-01-14 15:01:17.150  INFO 17943 --- [           main] o.s.b.web.embedded.netty.NettyWebServer  : Netty started on port(s): 9195
2021-01-14 15:01:17.154  INFO 17943 --- [           main] o.d.s.b.SoulBootstrapApplication         : Started SoulBootstrapApplication in 5.508 seconds (JVM running for 6.762)
</code></pre><h2 id=3-test>3. Test</h2><blockquote><p>Add the <code>soul-examples</code> module to soul&rsquo;s pom.xml for test.</p></blockquote><h3 id=3-1-startup-an-http-backend-service>3.1. Startup an HTTP backend service</h3><p>Startup <code>soul-examples-http</code></p><p>You can see the dependency in <code>soul-examples-http</code>&rsquo;s pom.xml.</p><pre><code class=language-xml>&lt;dependency&gt;
    &lt;groupId&gt;org.apache.shenyu&lt;/groupId&gt;
    &lt;artifactId&gt;soul-spring-boot-starter-client-springmvc&lt;/artifactId&gt;
    &lt;version&gt;${soul.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>Configure the <code>application.yml</code></p><pre><code class=language-yaml>soul:
  http:
    adminUrl: http://localhost:9095
    port: 8188
    contextPath: /http
    appName: http
    full: false
</code></pre><p>If <code>soul.http.full</code>=false, you need to add the <code>@SoulSpringMvcClient</code> annotation in controller or controller method.</p><h4 id=3-1-1-test-the-service>3.1.1. Test the service</h4><p>Visit <code>http://localhost:8188/test/findByUserId?userId=1</code> and the result as follows.</p><p><img src=/img/shenyu/01/16106235724795.jpg alt=-w684></p><h4 id=3-1-2-test-forward-http-request>3.1.2. Test forward HTTP request</h4><p>Visit <code>http://localhost:9195/http/test/findByUserId?userId=1</code> and the result as follows.</p><p><img src=/img/shenyu/01/16106237733891.jpg alt=-w665></p><p>You can see the following information in the console of <code>soul-bootstrap</code>. It means the forward HTTP request is successful.</p><pre><code class=language-shell>2021-01-14 20:42:57.123  INFO 29812 --- [work-threads-11] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:42:57.125  INFO 29812 --- [work-threads-11] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:42:57.126  INFO 29812 --- [work-threads-11] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8188/test/findByUserId?userId=1, retryTimes is 0
</code></pre><h3 id=3-2-startup-two-http-backend-services-to-simulate-load-balance>3.2. Startup two HTTP backend services to simulate load balance</h3><p>Choose <code>Allow parallel run</code></p><p>Change the port to <code>8189</code></p><p>Startup <code>soul-examples-http</code> again</p><p><img src=/img/shenyu/01/16106249542903.jpg alt=-w1104></p><h4 id=3-2-1-test-the-service>3.2.1. Test the service</h4><p>Visit <code>http://localhost:8189/test/findByUserId?userId=1</code> and the result as follows.</p><p><img src=/img/shenyu/01/16106250513285.jpg alt=-w693></p><h4 id=3-2-2-test-load-balance>3.2.2. Test load balance</h4><p><img src=/img/shenyu/01/16106266610601.jpg alt=-w1096></p><p>Configure two HTTP service in selector</p><p>Visit <code>http://localhost:9195/http/test/findByUserId?userId=1</code> more and more and result as follows.</p><p><img src=/img/shenyu/01/16106267572581.jpg alt=-w595>
You can see the following information in the console of <code>soul-bootstrap</code>. It means the load balance is successful.</p><pre><code class=language-shell>2021-01-14 20:48:34.460  INFO 29812 --- [work-threads-21] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:34.460  INFO 29812 --- [work-threads-21] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:34.460  INFO 29812 --- [work-threads-21] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8189/test/findByUserId?userId=1, retryTimes is 0
2021-01-14 20:48:35.147  INFO 29812 --- [work-threads-22] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:35.147  INFO 29812 --- [work-threads-22] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:35.147  INFO 29812 --- [work-threads-22] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8188/test/findByUserId?userId=1, retryTimes is 0
2021-01-14 20:48:38.755  INFO 29812 --- [work-threads-23] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:38.756  INFO 29812 --- [work-threads-23] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:38.756  INFO 29812 --- [work-threads-23] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8188/test/findByUserId?userId=1, retryTimes is 0
2021-01-14 20:48:39.609  INFO 29812 --- [work-threads-24] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:39.609  INFO 29812 --- [work-threads-24] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:39.609  INFO 29812 --- [work-threads-24] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8189/test/findByUserId?userId=1, retryTimes is 0
2021-01-14 20:48:40.317  INFO 29812 --- [work-threads-25] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:40.317  INFO 29812 --- [work-threads-25] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:40.317  INFO 29812 --- [work-threads-25] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8188/test/findByUserId?userId=1, retryTimes is 0
2021-01-14 20:48:40.976  INFO 29812 --- [-work-threads-1] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http
2021-01-14 20:48:40.976  INFO 29812 --- [-work-threads-1] o.d.soul.plugin.base.AbstractSoulPlugin  : divide selector success match , selector name :/http/test/**
2021-01-14 20:48:40.977  INFO 29812 --- [-work-threads-1] o.d.s.plugin.httpclient.WebClientPlugin  : The request urlPath is http://172.27.121.155:8188/test/findByUserId?userId=1, retryTimes is 0
</code></pre><h4 id=3-2-3-press-test>3.2.3. Press test</h4><p>Use <code>wrk</code> to press test and compare the two ways as follows.</p><ol><li>Visit the backend service directly.</li><li>Visit the service via soul.</li></ol><p>The performance drops slightly after using the gateway, probably because of the extra layer of forwarding.</p><pre><code class=language-shell>➜  ShenYu git:(master) ✗ wrk -t8 -c40 -d30s http://localhost:8189/test/findByUserId\?userId\=1
Running 30s test @ http://localhost:8189/test/findByUserId?userId=1
  8 threads and 40 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency     6.06ms   28.81ms 442.25ms   98.22%
    Req/Sec     2.05k   493.86     2.84k    74.82%
  486269 requests in 30.05s, 51.01MB read
Requests/sec:  16179.68
Transfer/sec:      1.70MB
➜  ShenYu git:(master) ✗ wrk -t8 -c40 -d30s http://localhost:9195/http/test/findByUserId\?userId\=1
Running 30s test @ http://localhost:9195/http/test/findByUserId?userId=1
  8 threads and 40 connections
  Thread Stats   Avg      Stdev     Max   +/- Stdev
    Latency    14.37ms   18.11ms 255.66ms   93.06%
    Req/Sec   459.41    139.11     1.01k    74.23%
  109533 requests in 30.09s, 11.49MB read
Requests/sec:   3639.60
Transfer/sec:    390.98KB
</code></pre><h4 id=3-2-4-problem-in-the-process>3.2.4. Problem in the process</h4><p>When startup the port of <code>8189</code>，but the output of console is still <code>8188</code>.</p><p><img src=/img/shenyu/01/16106270140398.jpg alt=-w1675></p><p>After modify the value of <code>soul.http.port</code>, the problem solved.</p><p><img src=/img/shenyu/01/16106405075031.jpg alt=-w520></p></article><div class=-show-mobile><nav class=ss-pagination-next><a class=link-prev href=/blog/apache-activites-introduce/><span class=text>Prev:</span>
<span class=text>Apache ShenYu Dream Code Book Club Introduction</span></a>
<a class=link-next href=/blog/shenyu_source_learning_05_plugin/><span class=text>Next:</span>
<span class=text>Apache ShenYu Gateway learning plugin chain and load balancing analysis</span></a></nav></div></main><aside class=ss-layout-aside><div class=ss-card><h2 class=card-title>Related</h2><ul class=ss-aside-related><li><a href=/blog/shenyu_source_learning_05_plugin/>Apache ShenYu Gateway learning plugin chain and load balancing analysis</a></li><li><a href=/news/shenyu-2.3.0/>【Soul gateway release milestone version 2.3.0】New support for grpc, tars and sofa protocols!</a></li></ul></div><div class="ss-aside-tags ss-card"><h2 class=card-title>Tag
<span class=card-extra></span></h2><ul class=tag-list><li class=tag><a href=/tags/apache/>Apache</a></li><li class=tag><a href=/tags/apache-shenyu/>Apache ShenYu</a></li><li class=tag><a href=/tags/code-conduct/>Code Conduct</a></li><li class=tag><a href=/tags/committer/>Committer</a></li><li class=tag><a href=/tags/contributor/>Contributor</a></li><li class=tag><a href=/tags/dreamcode/>DreamCode</a></li><li class=tag><a href=/tags/gateway/>GateWay</a></li><li class=tag><a href=/tags/icla/>ICLA</a></li><li class=tag><a href=/tags/issue-pr/>Issue-PR</a></li><li class=tag><a href=/tags/reactor/>Reactor</a></li><li class=tag><a href=/tags/subscribe-email/>Subscribe-Email</a></li><li class=tag><a href=/tags/two-fa/>Two-FA</a></li><li class=tag><a href=/tags/vote-committer/>Vote-Committer</a></li></ul></div></aside></div><footer class=ss-footer><div class=container><div class=links><div class="cate  -show-mobile"><h2 class=cate-title>Apache</h2><a class=link href=https://www.apache.org/>Foundation</a>
<a class=link href=https://github.com/apache/incubator-shenyu/issues>GitHub Issue Tracker</a>
<a class=link href=https://www.apache.org/licenses/>License</a>
<a class=link href=https://www.apache.org/security/>Security</a>
<a class=link href=http://www.apache.org/events/current-event>Events</a>
<a class=link href=http://www.apache.org/foundation/sponsorship.html>Sponsorship</a>
<a class=link href=http://www.apache.org/foundation/thanks.html>Thanks</a></div><div class=cate><h2 class=cate-title>Resources</h2><a class=link href=https://github.com/apache/incubator-shenyu>Github</a>
<a class=link href=/projects/shenyu/overview/>Documentation</a></div><div class=cate><h2 class=cate-title>Get Involved</h2><a class=link href=https://github.com/apache/incubator-shenyu/issues/new>Feedback</a>
<a class=link href=/community>Community</a>
<a class=link href=/news>News</a>
<a class=link href=/awesome>Awesome</a></div><div class=cate><h2 class=cate-title>Subscribe mailing list</h2><a class=link href=/community/subscribe-email/>How to subscribe</a>
<a class=link href=mailto://dev-subscribe@shenyu.apache.org>Subscribe Mail</a>
<a class=link href=https://lists.apache.org/list.html?dev@shenyu.apache.org>Mail Archive</a></div></div><div class=qrcode><div><img class=qrcode-img src=/img/qrcode/WechatIMG127.jpeg><p class=qrcode-desc>Wechat Official Account</p></div></div></div><div class=copyright><p>Copyright © 2021 The Apache Software Foundation. Licensed under the Apache License, Version 2.0.
Apache ShenYu, Apache Incubator, Apache, the Apache feather logo, the Apache ShenYu logo and the Apache Incubator project logo are trademarks of The Apache Software Foundation.
Apache ShenYu is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator.
Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects.
While incubation status is not necessarily a reflection of the completeness or stability of the code,
it does indicate that the project has yet to be fully endorsed by the ASF.</p></div></footer></body></html>